<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>浅析PHP混淆加密 | Manayakko - 微笑才是王道</title><meta name="description" content="浅析PHP混淆加密"><meta name="keywords" content="php,code audit"><meta name="author" content="Manayakko"><meta name="copyright" content="Manayakko"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/yakko117/img/favicon.png"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><meta name="twitter:card" content="summary"><meta name="twitter:title" content="浅析PHP混淆加密"><meta name="twitter:description" content="浅析PHP混淆加密"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/Manayakko/PicBed/img2/php_decode6.png"><meta property="og:type" content="article"><meta property="og:title" content="浅析PHP混淆加密"><meta property="og:url" content="https://manayakko.github.io/yakko117/2020/03/26/php%E6%B7%B7%E6%B7%86%E5%8A%A0%E5%AF%86/"><meta property="og:site_name" content="Manayakko - 微笑才是王道"><meta property="og:description" content="浅析PHP混淆加密"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Manayakko/PicBed/img2/php_decode6.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/yakko117/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://manayakko.github.io/yakko117/2020/03/26/php%E6%B7%B7%E6%B7%86%E5%8A%A0%E5%AF%86/"><link rel="prev" title="DDoS原理与防御" href="https://manayakko.github.io/yakko117/2020/03/29/Ddos%E5%AD%A6%E4%B9%A0/"><link rel="next" title="XXE漏洞学习" href="https://manayakko.github.io/yakko117/2020/03/18/XXElearn/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/yakko117/',
  algolia: undefined,
  localSearch: {"path":"./search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: false,
  copyright: {"languages":{"author":"作者: Manayakko","link":"链接: https://manayakko.github.io/yakko117/2020/03/26/php%E6%B7%B7%E6%B7%86%E5%8A%A0%E5%AF%86/","source":"来源: Manayakko - 微笑才是王道","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/yakko117/atom.xml" title="Manayakko - 微笑才是王道" type="application/atom+xml">
</head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/yakko117/">Manayakko - 微笑才是王道</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/yakko117/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/yakko117/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/yakko117/link/"><i class="fa-fw fa fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/yakko117/about/"><i class="fa-fw fa fa-simplybuilt"></i><span> 关于本人</span></a></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/yakko117/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/yakko117/archives/"><div class="headline">文章</div><div class="length_num">63</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/yakko117/tags/"><div class="headline">标签</div><div class="length_num">10</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/yakko117/categories/"><div class="headline">分类</div><div class="length_num">3</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/yakko117/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/yakko117/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/yakko117/link/"><i class="fa-fw fa fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/yakko117/about/"><i class="fa-fw fa fa-simplybuilt"></i><span> 关于本人</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#PWNHUB-%E5%85%AC%E5%BC%80%E8%B5%9B-2018-%E5%82%BB-fufu-%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%97%A5"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">[PWNHUB 公开赛 2018]傻 fufu 的工作日</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E8%A7%A3%E7%A0%81%E5%87%86%E5%A4%87"><span class="toc_mobile_items-number">1.1.</span> <span class="toc_mobile_items-text">解码准备</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E8%B0%83%E8%AF%95"><span class="toc_mobile_items-number">1.2.</span> <span class="toc_mobile_items-text">调试</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#33%E8%A1%8C"><span class="toc_mobile_items-number">1.2.1.</span> <span class="toc_mobile_items-text">33行</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#%E7%84%B6%E5%90%8E%E7%9C%8B%E5%90%8E%E9%9D%A2%E7%9A%84-38-42%E8%A1%8C%E4%BB%A3%E7%A0%81"><span class="toc_mobile_items-number">1.2.2.</span> <span class="toc_mobile_items-text">然后看后面的 38-42行代码</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#%E7%9C%8B44%E8%A1%8C"><span class="toc_mobile_items-number">1.2.3.</span> <span class="toc_mobile_items-text">看44行</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#47%E8%A1%8C%E6%89%BE%E5%88%B0%E5%85%B3%E9%94%AE%E6%80%A7%E4%BB%A3%E7%A0%81"><span class="toc_mobile_items-number">1.2.4.</span> <span class="toc_mobile_items-text">47行找到关键性代码</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#%E7%84%B6%E5%90%8E%E8%B7%B3%E5%88%B0%E6%9C%80%E5%90%8E"><span class="toc_mobile_items-number">1.2.5.</span> <span class="toc_mobile_items-text">然后跳到最后</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#50%E8%A1%8C-decode-func"><span class="toc_mobile_items-number">1.2.6.</span> <span class="toc_mobile_items-text">50行 decode_func</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E5%90%8E%E8%AF%9D"><span class="toc_mobile_items-number">1.3.</span> <span class="toc_mobile_items-text">后话</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#%E5%A4%A7%E8%87%B4%E7%9A%84%E5%8A%A0%E5%AF%86%E6%BA%90%E7%A0%81"><span class="toc_mobile_items-number">1.3.1.</span> <span class="toc_mobile_items-text">大致的加密源码</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#%E8%A7%A3%E7%A0%81"><span class="toc_mobile_items-number">1.3.2.</span> <span class="toc_mobile_items-text">解码</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E8%A7%A3%E9%A2%98"><span class="toc_mobile_items-number">1.4.</span> <span class="toc_mobile_items-text">解题</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#%E5%8F%82%E8%80%83"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">参考</span></a></li></ol></div></div></div><div id="body-wrap"><div id="web_bg" data-type="photo"></div><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#PWNHUB-%E5%85%AC%E5%BC%80%E8%B5%9B-2018-%E5%82%BB-fufu-%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%97%A5"><span class="toc-number">1.</span> <span class="toc-text">[PWNHUB 公开赛 2018]傻 fufu 的工作日</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E7%A0%81%E5%87%86%E5%A4%87"><span class="toc-number">1.1.</span> <span class="toc-text">解码准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E8%AF%95"><span class="toc-number">1.2.</span> <span class="toc-text">调试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#33%E8%A1%8C"><span class="toc-number">1.2.1.</span> <span class="toc-text">33行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%84%B6%E5%90%8E%E7%9C%8B%E5%90%8E%E9%9D%A2%E7%9A%84-38-42%E8%A1%8C%E4%BB%A3%E7%A0%81"><span class="toc-number">1.2.2.</span> <span class="toc-text">然后看后面的 38-42行代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9C%8B44%E8%A1%8C"><span class="toc-number">1.2.3.</span> <span class="toc-text">看44行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#47%E8%A1%8C%E6%89%BE%E5%88%B0%E5%85%B3%E9%94%AE%E6%80%A7%E4%BB%A3%E7%A0%81"><span class="toc-number">1.2.4.</span> <span class="toc-text">47行找到关键性代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%84%B6%E5%90%8E%E8%B7%B3%E5%88%B0%E6%9C%80%E5%90%8E"><span class="toc-number">1.2.5.</span> <span class="toc-text">然后跳到最后</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#50%E8%A1%8C-decode-func"><span class="toc-number">1.2.6.</span> <span class="toc-text">50行 decode_func</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E8%AF%9D"><span class="toc-number">1.3.</span> <span class="toc-text">后话</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%A7%E8%87%B4%E7%9A%84%E5%8A%A0%E5%AF%86%E6%BA%90%E7%A0%81"><span class="toc-number">1.3.1.</span> <span class="toc-text">大致的加密源码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E7%A0%81"><span class="toc-number">1.3.2.</span> <span class="toc-text">解码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98"><span class="toc-number">1.4.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">2.</span> <span class="toc-text">参考</span></a></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/Manayakko/PicBed/img2/php_decode6.png)"><div id="post-info"><div id="post-title"><div class="posttitle">浅析PHP混淆加密</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 发表于 2020-03-26<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> 更新于 2020-03-28</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/yakko117/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a></span><div class="post-meta-wordcount"><div class="post-meta-pv-cv"></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><p>通过一道题，来看一下php 混淆加密解密原理和分析<br>题目来自 [PWNHUB 公开赛 2018]傻 fufu 的工作日<br>这几天天天盯着这些鬼，眼睛都看瞎了<br>题目是个好题目，我看了Virink师傅和腹黑师傅的题解仍然发现自己很多不懂。还是太菜了<br>好好学习，好好学习</p>
<hr>
<h1 id="PWNHUB-公开赛-2018-傻-fufu-的工作日"><a href="#PWNHUB-公开赛-2018-傻-fufu-的工作日" class="headerlink" title="[PWNHUB 公开赛 2018]傻 fufu 的工作日"></a>[PWNHUB 公开赛 2018]傻 fufu 的工作日</h1><p>点开题目，是个上传，通过扫描后台，发现存在备份文件泄露，得到了 <code>index.php.bak</code><br>文件打开，发现全是乱码，但是注意到了一些细节因此我们来对源码进行一下分析</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/Manayakko/PicBed/img2/php_decode1.png" data-fancybox="group" data-caption="decode1" class="fancybox"><img alt="decode1" title="decode1" data-src="https://cdn.jsdelivr.net/gh/Manayakko/PicBed/img2/php_decode1.png" class="lazyload"></a></p>
<p>首先是开头的加密源网站</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">php</div></div><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="comment">/* PHP Encode by  http://Www.PHPJiaMi.Com/ */</span></span><br></pre></td></tr></table></figure></div>

<p>然后可以看到有颜色的代码最末尾有 <code>return *** ?&gt;</code> 来结束脚本运行，这说明结束标签后面的数据都不会被正常输出，后面极可能是<code>index.php</code> 源码，而前面的 php 代码只是用来加密的。</p>
<hr>
<h2 id="解码准备"><a href="#解码准备" class="headerlink" title="解码准备"></a>解码准备</h2><p>因为我的 <code>IDE</code> 是 <code>VSCode</code>，所以安装了 <code>PHP Debug</code> 插件<br>以及需要进行代码缩进格式化<br>然后找到了这个<a target="_blank" rel="noopener" href="https://github.com/nikic/PHP-Parser">工具PHP-Parser</a></p>
<p>使用工具前要先安装 <code>composer</code><br><a target="_blank" rel="noopener" href="https://getcomposer.org/download/">composer下载地址</a><br><a target="_blank" rel="noopener" href="https://developer.aliyun.com/composer">阿里云镜像</a></p>
<p>安装好 <code>composer</code> 后，进入下好的 <code>Parser</code> 文件夹，用命令输入</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer update</span><br></pre></td></tr></table></figure></div>

<p>让其生成所需要的库，然后将下面的代码保存成一个新的文件(例如 <code>format.php</code>)</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">php</div></div><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">PhpParser</span>\<span class="title">Error</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">PhpParser</span>\<span class="title">ParserFactory</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">PhpParser</span>\<span class="title">PrettyPrinter</span>;</span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;vendor/autoload.php&#x27;</span>;</span><br><span class="line"><span class="variable">$code</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line"><span class="variable">$parser</span> = (<span class="keyword">new</span> <span class="title class_">ParserFactory</span>)-&gt;<span class="title function_ invoke__">create</span>(<span class="title class_">ParserFactory</span>::<span class="variable constant_">PREFER_PHP7</span>);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="variable">$ast</span> = <span class="variable">$parser</span>-&gt;<span class="title function_ invoke__">parse</span>(<span class="variable">$code</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (<span class="built_in">Error</span> <span class="variable">$error</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Parse error: <span class="subst">&#123;$error-&gt;getMessage()&#125;</span>\n&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$prettyPrinter</span> = <span class="keyword">new</span> <span class="title class_">PrettyPrinter\Standard</span>;</span><br><span class="line"><span class="variable">$prettyCode</span> = <span class="variable">$prettyPrinter</span>-&gt;<span class="title function_ invoke__">prettyPrintFile</span>(<span class="variable">$ast</span>);</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;index2.php&#x27;</span>, <span class="variable">$prettyCode</span>);</span><br></pre></td></tr></table></figure></div>

<p>然后执行命令 <code>php format.php</code><br>然后将新生成的文件，以 <code>Western (ISO 8859-1)</code> 编码形式打开，这样可以显示更多非可显示字符而不是多字节的字符集</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/Manayakko/PicBed/img2/php_decode2.png" data-fancybox="group" data-caption="decode2" class="fancybox"><img alt="decode2" title="decode2" data-src="https://cdn.jsdelivr.net/gh/Manayakko/PicBed/img2/php_decode2.png" class="lazyload"></a></p>
<hr>
<h2 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h2><p>开头两行需要先注释掉，防止调试过程出现一些问题</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">php</div></div><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure></div>

<p>使用 <code>VSCode</code> 的调试功能，我们可以方便的查看变量的具体内容。</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/Manayakko/PicBed/img2/php_decode3.png" data-fancybox="group" data-caption="decode3" class="fancybox"><img alt="decode3" title="decode3" data-src="https://cdn.jsdelivr.net/gh/Manayakko/PicBed/img2/php_decode3.png" class="lazyload"></a></p>
<hr>
<h3 id="33行"><a href="#33行" class="headerlink" title="33行"></a>33行</h3><p>直到调试到这一行，发现直接跳出了。</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/Manayakko/PicBed/img2/php_decode4.png" data-fancybox="group" data-caption="decode4" class="fancybox"><img alt="decode4" title="decode4" data-src="https://cdn.jsdelivr.net/gh/Manayakko/PicBed/img2/php_decode4.png" class="lazyload"></a></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">php</div></div><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">php_sapi_name</span>() == <span class="string">&#x27;cli&#x27;</span> ? <span class="keyword">die</span>() : <span class="string">&#x27;&#x27;</span>;</span><br></pre></td></tr></table></figure></div>

<p>因为是用命令行运行调试，所以执行完这一句，程序就结束了。<br>然后将这一行注释掉，在他下面下断点。重新运行程序。</p>
<hr>
<p>34行是就是读取当前文件，这句话没有什么问题。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">php</div></div><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$f</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="title function_ invoke__">constant</span>(<span class="string">&#x27;jnggfmpt&#x27;</span>));</span><br></pre></td></tr></table></figure></div>

<p>然后就又是验证运行环境。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">php</div></div><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_HOST&#x27;</span>]) &amp;&amp; !<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;SERVER_ADDR&#x27;</span>]) &amp;&amp; !<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/Manayakko/PicBed/img2/php_decode5.png" data-fancybox="group" data-caption="decode5" class="fancybox"><img alt="decode5" title="decode5" data-src="https://cdn.jsdelivr.net/gh/Manayakko/PicBed/img2/php_decode5.png" class="lazyload"></a></p>
<h3 id="然后看后面的-38-42行代码"><a href="#然后看后面的-38-42行代码" class="headerlink" title="然后看后面的 38-42行代码"></a>然后看后面的 38-42行代码</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">php</div></div><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">argc = <span class="title function_ invoke__">microtime</span>(<span class="literal">true</span>) * <span class="number">1000</span>;</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">microtime</span>(<span class="literal">true</span>) * <span class="number">1000</span> - argc &gt; <span class="number">100</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>查了下，是用来防止下断点调试的，如果下断点调试，这里就超过 100 毫秒，然后就退出了。<br>因此决定直接在这条语句之后下断点，让代码一连串执行完，这样就不会超过 100 毫秒了,直接注释掉也行<br>然后再来看一下后面43行这个 <code>eval</code><br>回显结果跑到了71行这里</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/Manayakko/PicBed/img2/php_decode6.png" data-fancybox="group" data-caption="decode6" class="fancybox"><img alt="decode6" title="decode6" data-src="https://cdn.jsdelivr.net/gh/Manayakko/PicBed/img2/php_decode6.png" class="lazyload"></a></p>
<p>看起来好像没什么帮助，注释掉之后</p>
<h3 id="看44行"><a href="#看44行" class="headerlink" title="看44行"></a>看44行</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">php</div></div><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!<span class="title function_ invoke__">strpos</span>(<span class="title function_ invoke__">decode_func</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$f</span>, -<span class="number">45</span>, -<span class="number">1</span>)), <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$f</span>, <span class="number">0</span>, -<span class="number">46</span>))) ? <span class="variable">$undefined1</span>() : <span class="variable">$undefined2</span>;</span><br></pre></td></tr></table></figure></div>

<p>用来校验数据完整性的代码，这里的 <code>$undefined1</code> 和 <code>$undefined2</code> 都没有定义。如果验证失败，就会调用 <code>$undefined1</code> 会直接 <code>Error</code> 退出程序。而如果验证成功，虽然 <code>$undefined2</code> 变量不存在，但是只是一个 <code>Warning</code>，没有太大问题。</p>
<p>其中的 <code>decode_func</code> 就是加密代码中最后一个函数，专门负责字符串解码的。<br>验证方法就是把文件尾部分解密和前面的文件主体部分的 md5 对比，这次执行肯定又不能通过。<br>退出程序，注释掉，再重新运行。</p>
<hr>
<h3 id="47行找到关键性代码"><a href="#47行找到关键性代码" class="headerlink" title="47行找到关键性代码"></a>47行找到关键性代码</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">php</div></div><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$decrypted</span> = <span class="title function_ invoke__">str_rot13</span>(@<span class="title function_ invoke__">gzuncompress</span>(<span class="title function_ invoke__">decode_func</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$f</span>, -<span class="number">1522</span>, -<span class="number">46</span>))));</span><br></pre></td></tr></table></figure></div>

<p>同时可以看到已经 <code>return</code> 加密前的代码了，上述的 <code>-1522</code>就是最先提到的加密代码末尾 <code>?&gt;</code> 后的第一个字符</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/Manayakko/PicBed/img2/php_decode7.png" data-fancybox="group" data-caption="decode7" class="fancybox"><img alt="decode7" title="decode7" data-src="https://cdn.jsdelivr.net/gh/Manayakko/PicBed/img2/php_decode7.png" class="lazyload"></a></p>
<h3 id="然后跳到最后"><a href="#然后跳到最后" class="headerlink" title="然后跳到最后"></a>然后跳到最后</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">php</div></div><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$f_varname</span> = <span class="string">&#x27;_f_&#x27;</span>;</span><br><span class="line"><span class="variable">$decrypted</span> = <span class="title function_ invoke__">check_and_decrypt</span>($&#123;<span class="variable">$f_varname</span>&#125;);</span><br><span class="line"><span class="title function_ invoke__">set_include_path</span>(<span class="title function_ invoke__">dirname</span>($&#123;<span class="variable">$f_varname</span>&#125;));</span><br><span class="line"><span class="variable">$base64_encoded_decrypted</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$decrypted</span>);</span><br><span class="line"><span class="variable">$eval_string</span> = <span class="string">&#x27;eval(base64_decode($base64_encoded_decrypted));&#x27;</span>;</span><br><span class="line"><span class="variable">$result</span> = <span class="keyword">eval</span>(<span class="variable">$eval_string</span>);</span><br><span class="line"><span class="title function_ invoke__">set_include_path</span>(<span class="title function_ invoke__">dirname</span>($&#123;<span class="variable">$f_varname</span>&#125;));</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$result</span>;</span><br></pre></td></tr></table></figure></div>

<p>怎么打印出来呢<br>直接在 <code>$decrypted</code> 后面加上一行 <code>file_put_contents</code> 就可以了。</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/Manayakko/PicBed/img2/php_decode7_2.png" data-fancybox="group" data-caption="decode7_2" class="fancybox"><img alt="decode7_2" title="decode7_2" data-src="https://cdn.jsdelivr.net/gh/Manayakko/PicBed/img2/php_decode7_2.png" class="lazyload"></a></p>
<p>然后便可以看到解密后的源码</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/Manayakko/PicBed/img2/php_decode8.png" data-fancybox="group" data-caption="decode8" class="fancybox"><img alt="decode8" title="decode8" data-src="https://cdn.jsdelivr.net/gh/Manayakko/PicBed/img2/php_decode8.png" class="lazyload"></a></p>
<p>如果将上述的 35行 <code>server_host</code> 改成 <code>&#39;127.0.0.1&#39;</code> 还可以看到服务器返回的请求验证数据代码</p>
<h3 id="50行-decode-func"><a href="#50行-decode-func" class="headerlink" title="50行 decode_func"></a>50行 decode_func</h3><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/Manayakko/PicBed/img2/php_decode9.png" data-fancybox="group" data-caption="decode9" class="fancybox"><img alt="decode9" title="decode9" data-src="https://cdn.jsdelivr.net/gh/Manayakko/PicBed/img2/php_decode9.png" class="lazyload"></a></p>
<h2 id="后话"><a href="#后话" class="headerlink" title="后话"></a>后话</h2><p>感谢 <a target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-693641-1-1.html">Ganlv 师傅</a> 的一路指导</p>
<h3 id="大致的加密源码"><a href="#大致的加密源码" class="headerlink" title="大致的加密源码"></a>大致的加密源码</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">php</div></div><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 先把这两行去掉，防止出现什么问题，我们还什么都不知道。</span></span><br><span class="line"><span class="comment">// error_reporting(0);</span></span><br><span class="line"><span class="comment">// ini_set(&quot;display_errors&quot;, 0);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">defined</span>(<span class="string">&#x27;jnggfmpt&#x27;</span>)) &#123;</span><br><span class="line">    <span class="title function_ invoke__">define</span>(<span class="string">&#x27;jnggfmpt&#x27;</span>, <span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;func2&#x27;</span>) == <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="comment">// 第一个函数返回 &#x27;base64_decode&#x27; ，这个函数不依赖其他任何函数，单纯地返回一个字符串 &#x27;base64_decode&#x27;。</span></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">func1</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable">$v1</span> = <span class="string">&#x27;6f6e66723634&#x27;</span>;</span><br><span class="line">            <span class="variable">$v2</span> = <span class="string">&#x27;pa&#x27;</span>;</span><br><span class="line">            <span class="variable">$v3</span> = <span class="string">&#x27;7374725f&#x27;</span>;</span><br><span class="line">            <span class="variable">$v4</span> = <span class="string">&#x27;H&#x27;</span> . <span class="string">&#x27;*&#x27;</span>;</span><br><span class="line">            <span class="variable">$v2</span> .= <span class="string">&#x27;ck&#x27;</span>; <span class="comment">// $v2 = &#x27;pack&#x27;;</span></span><br><span class="line">            <span class="variable">$v1</span> .= <span class="string">&#x27;5f717270627172&#x27;</span>; <span class="comment">// $v1 = &#x27;6f6e667236345f717270627172&#x27;;</span></span><br><span class="line">            <span class="variable">$v3</span> .= <span class="string">&#x27;726f743133&#x27;</span>; <span class="comment">// $v3 = &#x27;7374725f726f743133&#x27;;</span></span><br><span class="line">            <span class="comment">// $v5 = $v2($v4, $v3);</span></span><br><span class="line">            <span class="variable">$v5</span> = <span class="title function_ invoke__">pack</span>(<span class="string">&#x27;H*&#x27;</span>, <span class="string">&#x27;7374725f726f743133&#x27;</span>);</span><br><span class="line">            <span class="comment">// $v5 = &#x27;str_rot13&#x27;;</span></span><br><span class="line">            <span class="comment">// $v6 = $v5($v2($v4, $v1));</span></span><br><span class="line">            <span class="variable">$v6</span> = <span class="title function_ invoke__">str_rot13</span>(<span class="title function_ invoke__">pack</span>(<span class="string">&#x27;H*&#x27;</span>, <span class="string">&#x27;6f6e667236345f717270627172&#x27;</span>));</span><br><span class="line">            <span class="comment">// $v6 = &#x27;base64_decode&#x27;;</span></span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$v6</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 第二个函数接受两个参数，要注意第一个参数还是一个引用参数。</span></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">func2</span>(<span class="params">&amp;<span class="variable">$arg1</span>, <span class="variable">$arg2</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">// 第一句是令一堆变量等于 func4</span></span><br><span class="line">            <span class="comment">// $v1 - $v5 都使用 func4 解码一个字符串，结果如下</span></span><br><span class="line">            <span class="variable">$v1</span> = <span class="string">&#x27;str_rot13&#x27;</span>;</span><br><span class="line">            <span class="variable">$v2</span> = <span class="string">&#x27;strrev&#x27;</span>;</span><br><span class="line">            <span class="variable">$v3</span> = <span class="string">&#x27;gzuncompress&#x27;</span>;</span><br><span class="line">            <span class="variable">$v4</span> = <span class="string">&#x27;stripslashes&#x27;</span>;</span><br><span class="line">            <span class="variable">$v5</span> = <span class="string">&#x27;explode&#x27;</span>;</span><br><span class="line">            <span class="comment">// $v6 = $v1($v2($v3($v4(func4(&#x27;??????&#x27;)))));</span></span><br><span class="line">            <span class="comment">// $v6 = str_rot13(strrev(gzuncompress(stripslashes(func4(&#x27;??????&#x27;)))));</span></span><br><span class="line">            <span class="variable">$v6</span> = <span class="string">&#x27;,chr,addslashes,rand,gzuncompress,assert_options,assert,file_get_contents,substr,unpack,constant,strpos,create_function,str_rot13,md5,set_include_path,dirname,preg_replace,base64_encode,base64_decode,&#x27;</span>;</span><br><span class="line">            <span class="comment">// $v7 = $v5($v6);</span></span><br><span class="line">            <span class="comment">// $v7 = explode($v6);</span></span><br><span class="line">            <span class="variable">$v7</span> = <span class="keyword">array</span>(</span><br><span class="line">                <span class="number">0</span> =&gt; <span class="string">&quot;&quot;</span>,</span><br><span class="line">                <span class="number">1</span> =&gt; <span class="string">&quot;chr&quot;</span>,</span><br><span class="line">                <span class="number">2</span> =&gt; <span class="string">&quot;addslashes&quot;</span>,</span><br><span class="line">                <span class="number">3</span> =&gt; <span class="string">&quot;rand&quot;</span>,</span><br><span class="line">                <span class="number">4</span> =&gt; <span class="string">&quot;gzuncompress&quot;</span>,</span><br><span class="line">                <span class="number">5</span> =&gt; <span class="string">&quot;assert_options&quot;</span>,</span><br><span class="line">                <span class="number">6</span> =&gt; <span class="string">&quot;assert&quot;</span>,</span><br><span class="line">                <span class="number">7</span> =&gt; <span class="string">&quot;file_get_contents&quot;</span>,</span><br><span class="line">                <span class="number">8</span> =&gt; <span class="string">&quot;substr&quot;</span>,</span><br><span class="line">                <span class="number">9</span> =&gt; <span class="string">&quot;unpack&quot;</span>,</span><br><span class="line">                <span class="number">10</span> =&gt; <span class="string">&quot;constant&quot;</span>,</span><br><span class="line">                <span class="number">11</span> =&gt; <span class="string">&quot;strpos&quot;</span>,</span><br><span class="line">                <span class="number">12</span> =&gt; <span class="string">&quot;create_function&quot;</span>,</span><br><span class="line">                <span class="number">13</span> =&gt; <span class="string">&quot;str_rot13&quot;</span>,</span><br><span class="line">                <span class="number">14</span> =&gt; <span class="string">&quot;md5&quot;</span>,</span><br><span class="line">                <span class="number">15</span> =&gt; <span class="string">&quot;set_include_path&quot;</span>,</span><br><span class="line">                <span class="number">16</span> =&gt; <span class="string">&quot;dirname&quot;</span>,</span><br><span class="line">                <span class="number">17</span> =&gt; <span class="string">&quot;preg_replace&quot;</span>,</span><br><span class="line">                <span class="number">18</span> =&gt; <span class="string">&quot;base64_encode&quot;</span>,</span><br><span class="line">                <span class="number">19</span> =&gt; <span class="string">&quot;base64_decode&quot;</span>,</span><br><span class="line">                <span class="number">20</span> =&gt; <span class="string">&quot;&quot;</span>,</span><br><span class="line">            );</span><br><span class="line">            <span class="variable">$arg1</span> = <span class="variable">$v7</span>[<span class="variable">$arg2</span>];</span><br><span class="line">            <span class="comment">// 看到这里知道了，这个函数就是用来需要用的提取函数名的</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 第三个函数被主程序调用了</span></span><br><span class="line">        <span class="comment">// 不过分析之后发现这个 $arg1 参数并没有用到</span></span><br><span class="line">        <span class="comment">// 这个函数的前半部分是防止调试</span></span><br><span class="line">        <span class="comment">// 后半部分是提取后面加密的代码</span></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">func3</span>(<span class="params"><span class="variable">$arg1</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$_v1</span>, <span class="comment">// $_v1 = &#x27;file_get_contents&#x27;;</span></span><br><span class="line">            <span class="variable">$_v3</span>, <span class="comment">// $_v3 = &#x27;substr&#x27;;</span></span><br><span class="line">            <span class="variable">$_v4</span>, <span class="comment">// $_v4 = &#x27;assert&#x27;;</span></span><br><span class="line">            <span class="variable">$_v5</span>, <span class="comment">// $_v5 = &#x27;assert_options&#x27;;</span></span><br><span class="line">            <span class="variable">$_v6</span>, <span class="comment">// $_v6 = &#x27;unpack&#x27;;</span></span><br><span class="line">            <span class="variable">$_v7</span>, <span class="comment">// $_v7 = &#x27;constant&#x27;;</span></span><br><span class="line">            <span class="variable">$_v8</span>, <span class="comment">// $_v8 = &#x27;preg_replace&#x27;;</span></span><br><span class="line">            <span class="variable">$_v9</span>, <span class="comment">// $_v9 = &#x27;base64_encode&#x27;;</span></span><br><span class="line">            <span class="variable">$_v10</span>, <span class="comment">// $_v10 = &#x27;gzuncompress&#x27;;</span></span><br><span class="line">            <span class="variable">$_v11</span>, <span class="comment">// $_v11 = &#x27;create_function&#x27;;</span></span><br><span class="line">            <span class="variable">$_v12</span>, <span class="comment">// $_v12 = &#x27;strpos&#x27;;</span></span><br><span class="line">            <span class="variable">$_v13</span>, <span class="comment">// $_v13 = &#x27;addslashes&#x27;;</span></span><br><span class="line">            <span class="variable">$_v14</span>, <span class="comment">// $_v14 = &#x27;str_rot13&#x27;;</span></span><br><span class="line">            <span class="variable">$_v15</span>, <span class="comment">// $_v15 = &#x27;md5&#x27;;</span></span><br><span class="line">            <span class="variable">$_v16</span>, <span class="comment">// $_v16 = &#x27;set_include_path&#x27;;</span></span><br><span class="line">            <span class="variable">$_v17</span>; <span class="comment">// $_v17 = &#x27;dirname&#x27;;</span></span><br><span class="line">            <span class="comment">// 这里有一堆变量等于 func4，然后用他们解码得到 $v1 - $v5</span></span><br><span class="line">            <span class="variable">$v1</span> = <span class="string">&#x27;php_sapi_name&#x27;</span>;</span><br><span class="line">            <span class="variable">$v2</span> = <span class="string">&#x27;die&#x27;</span>;</span><br><span class="line">            <span class="variable">$v3</span> = <span class="string">&#x27;cli&#x27;</span>;</span><br><span class="line">            <span class="variable">$v4</span> = <span class="string">&#x27;microtime&#x27;</span>;</span><br><span class="line">            <span class="variable">$v5</span> = <span class="string">&#x27;1000&#x27;</span>;</span><br><span class="line">            <span class="comment">// $v1() == $v3 ? $v2() : &#x27;&#x27;;</span></span><br><span class="line">            <span class="comment">// 这句话在调试的时候需要注释掉</span></span><br><span class="line">            <span class="title function_ invoke__">php_sapi_name</span>() == <span class="string">&#x27;cli&#x27;</span> ? <span class="keyword">die</span>() : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="comment">// file_get_contents(constant(func4(&#x27;??????&#x27;)));</span></span><br><span class="line">            <span class="variable">$v7</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">            <span class="comment">// $v8 = $v4(true) * $v5;</span></span><br><span class="line">            <span class="variable">$v8</span> = <span class="title function_ invoke__">microtime</span>(<span class="literal">true</span>) * <span class="number">1000</span>;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">            <span class="comment">// if ($v4(true) * $v5 - $v8 &gt; 100) &#123;</span></span><br><span class="line">            <span class="comment">// 这里是防止下断点调试的，下断点调试，这里就超过 100 毫秒了，直接注释掉</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">microtime</span>(<span class="literal">true</span>) * <span class="number">1000</span> - <span class="variable">$v8</span> &gt; <span class="number">100</span>) &#123;</span><br><span class="line">                <span class="comment">// $v2();</span></span><br><span class="line">                <span class="keyword">die</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// eval(func4(&#x27;??????&#x27;));</span></span><br><span class="line">            <span class="keyword">eval</span>(<span class="string">&#x27;if(strpos(__FILE__, msvigqgq) !== 0)&#123;$exitfunc();&#125;&#x27;</span>);</span><br><span class="line">            <span class="comment">// $_v12(func4($_v3($v7, func4(&#x27;??????&#x27;), func4(&#x27;??????&#x27;))), $_v15($_v3($v7, func4(&#x27;??????&#x27;), func4(&#x27;??????&#x27;)))) ? $v9() : $v10;</span></span><br><span class="line">            <span class="comment">// 这里的 $v9 和 $v10 都没有定义，如果验证失败，就会调用 $v9 会直接出错退出程序</span></span><br><span class="line">            <span class="comment">// 而如果验证成功 $v10 变量不存在则没问题</span></span><br><span class="line">            <span class="comment">// 验证方法就是把文件尾部分解密和前面的文件主体部分的md5对比，直接注释掉</span></span><br><span class="line">            !<span class="title function_ invoke__">strpos</span>(<span class="title function_ invoke__">func4</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$v7</span>, -<span class="number">45</span>, -<span class="number">1</span>)), <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$v7</span>, <span class="number">0</span>, -<span class="number">46</span>))) ? <span class="variable">$v9</span>() : <span class="variable">$v10</span>;</span><br><span class="line">            <span class="comment">// 这两个数值是通过 func4 解码得到的</span></span><br><span class="line">            <span class="variable">$v11</span> = <span class="string">&#x27;-2586&#x27;</span>;</span><br><span class="line">            <span class="variable">$v12</span> = <span class="string">&#x27;-46&#x27;</span>;</span><br><span class="line">            <span class="comment">// $v12 = $_v14(@$_v10(func4(substr($v7, $v11, $v12))));</span></span><br><span class="line">            <span class="variable">$v12</span> = <span class="title function_ invoke__">str_rot13</span>(@<span class="title function_ invoke__">gzuncompress</span>(<span class="title function_ invoke__">func4</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$v7</span>, <span class="variable">$v11</span>, <span class="variable">$v12</span>))));</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$v12</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 第四个函数有点复杂，这是一个解码函数，用的是异或算法解密，所有调用 func4 的位置都没有提供 $arg2</span></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">func4</span>(<span class="params"><span class="variable">$arg1</span>, <span class="variable">$arg2</span> = <span class="string">&#x27;&#x27;</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable">$v1</span> = <span class="string">&#x27;base64_decode&#x27;</span>;</span><br><span class="line">            <span class="comment">// $v2 - $v4 通过 base64_decode 解码得到</span></span><br><span class="line">            <span class="variable">$v2</span> = <span class="string">&#x27;ord&#x27;</span>;</span><br><span class="line">            <span class="variable">$v3</span> = <span class="string">&#x27;strlen&#x27;</span>;</span><br><span class="line">            <span class="variable">$v4</span> = <span class="string">&#x27;chr&#x27;</span>;</span><br><span class="line">            <span class="comment">// $arg2 = !$arg2 ? $v2(&#x27;?&#x27;) : $arg2;</span></span><br><span class="line">            <span class="comment">// $arg2 = !$arg2 ? 136 : $arg2;</span></span><br><span class="line">            <span class="variable">$arg2</span> = <span class="number">136</span>;</span><br><span class="line">            <span class="comment">// 这里 $v5 不存在，所以 $v6 = null;</span></span><br><span class="line">            <span class="variable">$v6</span> = <span class="variable">$v5</span>;</span><br><span class="line">            <span class="comment">// for (; $v6 &lt; $v3($arg1); $v6++) &#123;</span></span><br><span class="line">            <span class="keyword">for</span> (; <span class="variable">$v6</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$arg1</span>); <span class="variable">$v6</span>++) &#123;</span><br><span class="line">                <span class="comment">// $v7 .= $v2($arg1[$v6]) &lt; $v2(&#x27;?&#x27;) ? $v2($arg1[$v6]) &gt; $arg2 &amp;&amp; $v2($arg1[$v6]) &lt; 245 ? $v4($v2($arg1[$v6]) / 2) : $arg1[$v6] : &#x27;&#x27;;</span></span><br><span class="line">                <span class="variable">$v7</span> .= <span class="title function_ invoke__">ord</span>(<span class="variable">$arg1</span>[<span class="variable">$v6</span>]) &lt; <span class="number">245</span> ? <span class="title function_ invoke__">ord</span>(<span class="variable">$arg1</span>[<span class="variable">$v6</span>]) &gt; <span class="variable">$arg2</span> &amp;&amp; <span class="title function_ invoke__">ord</span>(<span class="variable">$arg1</span>[<span class="variable">$v6</span>]) &lt; <span class="number">245</span> ? <span class="title function_ invoke__">chr</span>(<span class="title function_ invoke__">ord</span>(<span class="variable">$arg1</span>[<span class="variable">$v6</span>]) / <span class="number">2</span>) : <span class="variable">$arg1</span>[<span class="variable">$v6</span>] : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// $v8 = $v1($v7);</span></span><br><span class="line">            <span class="variable">$v8</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$v7</span>);</span><br><span class="line">            <span class="variable">$v9</span> = <span class="string">&#x27;md5&#x27;</span>; <span class="comment">// $v9 通过 base64_decode 解码得到</span></span><br><span class="line">            <span class="variable">$v6</span> = <span class="variable">$v5</span>;</span><br><span class="line">            <span class="comment">// $arg2 = $v9(&#x27;8_Q.L2&#x27;);</span></span><br><span class="line">            <span class="comment">// $arg2 = md5(&#x27;8_Q.L2&#x27;);</span></span><br><span class="line">            <span class="variable">$arg2</span> = <span class="string">&#x27;fac02565267d815643cecee75a16c7bd&#x27;</span>;</span><br><span class="line">            <span class="comment">// $v10 = $ctrmax = $v3($arg2);</span></span><br><span class="line">            <span class="comment">// $v10 = $ctrmax = strlen($arg2);</span></span><br><span class="line">            <span class="variable">$v10</span> = <span class="variable">$ctrmax</span> = <span class="number">32</span>;</span><br><span class="line">            <span class="comment">// for (; $v6 &lt; $v3($v8); $v6++) &#123;</span></span><br><span class="line">            <span class="keyword">for</span> (; <span class="variable">$v6</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$v8</span>); <span class="variable">$v6</span>++) &#123;</span><br><span class="line">                <span class="variable">$v10</span> = <span class="variable">$v10</span> ? <span class="variable">$v10</span> : <span class="variable">$ctrmax</span>;</span><br><span class="line">                <span class="variable">$v10</span>--;</span><br><span class="line">                <span class="variable">$v11</span> .= <span class="variable">$v8</span>[<span class="variable">$v6</span>] ^ <span class="variable">$arg2</span>[<span class="variable">$v10</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$v11</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">global</span> <span class="variable">$_v1</span>, <span class="comment">// $_v1 = &#x27;file_get_contents&#x27;;</span></span><br><span class="line"><span class="variable">$_v2</span>, <span class="comment">// $_v2 = &#x27;chr&#x27;;</span></span><br><span class="line"><span class="variable">$_v3</span>, <span class="comment">// $_v3 = &#x27;substr&#x27;;</span></span><br><span class="line"><span class="variable">$_v4</span>, <span class="comment">// $_v4 = &#x27;assert&#x27;;</span></span><br><span class="line"><span class="variable">$_v5</span>, <span class="comment">// $_v5 = &#x27;assert_options&#x27;;</span></span><br><span class="line"><span class="variable">$_v6</span>, <span class="comment">// $_v6 = &#x27;unpack&#x27;;</span></span><br><span class="line"><span class="variable">$_v7</span>, <span class="comment">// $_v7 = &#x27;constant&#x27;;</span></span><br><span class="line"><span class="variable">$_v8</span>, <span class="comment">// $_v8 = &#x27;preg_replace&#x27;;</span></span><br><span class="line"><span class="variable">$_v9</span>, <span class="comment">// $_v9 = &#x27;base64_encode&#x27;;</span></span><br><span class="line"><span class="variable">$_v10</span>, <span class="comment">// $_v10 = &#x27;gzuncompress&#x27;;</span></span><br><span class="line"><span class="variable">$_v11</span>, <span class="comment">// $_v11 = &#x27;create_function&#x27;;</span></span><br><span class="line"><span class="variable">$_v12</span>, <span class="comment">// $_v12 = &#x27;strpos&#x27;;</span></span><br><span class="line"><span class="variable">$_v13</span>, <span class="comment">// $_v13 = &#x27;addslashes&#x27;;</span></span><br><span class="line"><span class="variable">$_v14</span>, <span class="comment">// $_v14 = &#x27;str_rot13&#x27;;</span></span><br><span class="line"><span class="variable">$_v15</span>, <span class="comment">// $_v15 = &#x27;md5&#x27;;</span></span><br><span class="line"><span class="variable">$_v16</span>, <span class="comment">// $_v16 = &#x27;set_include_path&#x27;;</span></span><br><span class="line"><span class="variable">$_v17</span>; <span class="comment">// $_v17 = &#x27;dirname&#x27;;</span></span><br><span class="line"><span class="comment">// 然后一堆变量等于 func2</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$_v1</span>) &#123;</span><br><span class="line">    <span class="comment">// 使用 func2 用传递引用变量的方法赋值，简化之后如下</span></span><br><span class="line">    <span class="variable">$_v1</span> = <span class="string">&#x27;file_get_contents&#x27;</span>;</span><br><span class="line">    <span class="variable">$_v3</span> = <span class="string">&#x27;substr&#x27;</span>;</span><br><span class="line">    <span class="variable">$_v6</span> = <span class="string">&#x27;unpack&#x27;</span>;</span><br><span class="line">    <span class="variable">$_v10</span> = <span class="string">&#x27;gzuncompress&#x27;</span>;</span><br><span class="line">    <span class="variable">$_v11</span> = <span class="string">&#x27;create_function&#x27;</span>;</span><br><span class="line">    <span class="variable">$_v12</span> = <span class="string">&#x27;strpos&#x27;</span>;</span><br><span class="line">    <span class="variable">$_v13</span> = <span class="string">&#x27;addslashes&#x27;</span>;</span><br><span class="line">    <span class="variable">$_v14</span> = <span class="string">&#x27;str_rot13&#x27;</span>;</span><br><span class="line">    <span class="variable">$_v15</span> = <span class="string">&#x27;md5&#x27;</span>;</span><br><span class="line">    <span class="variable">$_v16</span> = <span class="string">&#x27;set_include_path&#x27;</span>;</span><br><span class="line">    <span class="variable">$_v17</span> = <span class="string">&#x27;dirname&#x27;</span>;</span><br><span class="line">    <span class="variable">$_v8</span> = <span class="string">&#x27;preg_replace&#x27;</span>;</span><br><span class="line">    <span class="variable">$_v9</span> = <span class="string">&#x27;base64_encode&#x27;</span>;</span><br><span class="line">    <span class="variable">$_v7</span> = <span class="string">&#x27;constant&#x27;</span>;</span><br><span class="line">    <span class="variable">$_v5</span> = <span class="string">&#x27;assert_options&#x27;</span>;</span><br><span class="line">    <span class="variable">$_v4</span> = <span class="string">&#x27;assert&#x27;</span>;</span><br><span class="line">    <span class="variable">$_v2</span> = <span class="string">&#x27;chr&#x27;</span>;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="string">&#x27;rand&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 一堆变量等于 func4，然后用 func4 解码</span></span><br><span class="line"><span class="variable">$v2</span> = <span class="string">&#x27;_f_&#x27;</span>;</span><br><span class="line"><span class="variable">$v3</span> = <span class="title function_ invoke__">func3</span>($&#123;<span class="variable">$v2</span>&#125;);</span><br><span class="line"><span class="comment">// $_v16($_v17($&#123;$v2&#125;));</span></span><br><span class="line"><span class="title function_ invoke__">set_include_path</span>(<span class="title function_ invoke__">dirname</span>($&#123;<span class="variable">$v2</span>&#125;));</span><br><span class="line"><span class="comment">// $v4 = $_v9($v3);</span></span><br><span class="line"><span class="variable">$v4</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$v3</span>);</span><br><span class="line"><span class="comment">// $v5 = func4(&#x27;??????&#x27;);</span></span><br><span class="line"><span class="comment">// 解密之后的原文不是 $v4，这里是翻译之后的</span></span><br><span class="line"><span class="variable">$v5</span> = <span class="string">&#x27;eval(base64_decode($v4));&#x27;</span>;</span><br><span class="line"><span class="comment">// $v5 = $_v8(func4(&#x27;??????&#x27;), $v5, func4(&#x27;??????&#x27;));</span></span><br><span class="line"><span class="comment">// mixed preg_replace ( mixed $pattern , mixed $replacement , mixed $subject [, int $limit = -1 [, int &amp;$count ]] )</span></span><br><span class="line"><span class="comment">// PCRE 修饰符 e (PREG_REPLACE_EVAL)</span></span><br><span class="line"><span class="comment">// Warning: This feature was DEPRECATED in PHP 5.5.0, and REMOVED as of PHP 7.0.0.</span></span><br><span class="line"><span class="comment">// If this deprecated modifier is set, preg_replace() does normal substitution of backreferences in the replacement string, evaluates it as PHP code, and uses the result for replacing the search string. Single quotes, double quotes, backslashes (\) and NULL chars will be escaped by backslashes in substituted backreferences.</span></span><br><span class="line"><span class="comment">// 换句话说 preg_replace 如果带 e 的话，第一步，正常地进行正则表达式替换（反向引用也会被正常替换，就是完全正常的正则替换），第二步，把结果 eval 作为最终结果</span></span><br><span class="line"><span class="comment">// 简而言之 $v5 = eval($v5);</span></span><br><span class="line"><span class="variable">$v5</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/0dcaf9/e&#x27;</span>, <span class="variable">$v5</span>, <span class="string">&#x27;0dcaf9&#x27;</span>);</span><br><span class="line"><span class="comment">// 把上述几步统一一下 $v5 = eval(func3($_f_));</span></span><br><span class="line"><span class="comment">// $_v16($_v17($&#123;$v2&#125;));</span></span><br><span class="line"><span class="title function_ invoke__">set_include_path</span>(<span class="title function_ invoke__">dirname</span>($&#123;<span class="variable">$v2</span>&#125;));</span><br><span class="line"><span class="comment">// 把解码之后的文件运行结果返回</span></span><br><span class="line"><span class="keyword">return</span> <span class="variable">$v5</span>;</span><br></pre></td></tr></table></figure></div>

<h3 id="解码"><a href="#解码" class="headerlink" title="解码"></a>解码</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">php</div></div><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">decrypt</span>(<span class="params"><span class="variable">$data</span>, <span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$data_1</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$data</span>); <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$ch</span> = <span class="title function_ invoke__">ord</span>(<span class="variable">$data</span>[<span class="variable">$i</span>]);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$ch</span> &lt; <span class="number">245</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$ch</span> &gt; <span class="number">136</span>) &#123;</span><br><span class="line">                <span class="variable">$data_1</span> .= <span class="title function_ invoke__">chr</span>(<span class="variable">$ch</span> / <span class="number">2</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$data_1</span> .= <span class="variable">$data</span>[<span class="variable">$i</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$data_1</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$data_1</span>);</span><br><span class="line">    <span class="variable">$key</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$key</span>);</span><br><span class="line">    <span class="variable">$j</span> = <span class="variable">$ctrmax</span> = <span class="number">32</span>;</span><br><span class="line">    <span class="variable">$data_2</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$data_1</span>); <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$j</span> &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="variable">$j</span> = <span class="variable">$ctrmax</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$j</span>--;</span><br><span class="line">        <span class="variable">$data_2</span> .=  <span class="variable">$data_1</span>[<span class="variable">$i</span>] ^ <span class="variable">$key</span>[<span class="variable">$j</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$data_2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">find_data</span>(<span class="params"><span class="variable">$code</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$code_end</span> = <span class="title function_ invoke__">strrpos</span>(<span class="variable">$code</span>, <span class="string">&#x27;?&gt;&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$code_end</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$data_start</span> = <span class="variable">$code_end</span> + <span class="number">2</span>;</span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$code</span>, <span class="variable">$data_start</span>, -<span class="number">46</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$data</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">find_key</span>(<span class="params"><span class="variable">$code</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// $v1 = $v2(&#x27;bWQ1&#x27;);</span></span><br><span class="line">    <span class="comment">// $key1 = $v1(&#x27;??????&#x27;);</span></span><br><span class="line">    <span class="variable">$pos1</span> = <span class="title function_ invoke__">strpos</span>(<span class="variable">$code</span>, <span class="string">&quot;(&#x27;&quot;</span> . <span class="title function_ invoke__">preg_quote</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="string">&#x27;md5&#x27;</span>)) . <span class="string">&quot;&#x27;);&quot;</span>);</span><br><span class="line">    <span class="variable">$pos2</span> = <span class="title function_ invoke__">strrpos</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$code</span>, <span class="number">0</span>, <span class="variable">$pos1</span>), <span class="string">&#x27;$&#x27;</span>);</span><br><span class="line">    <span class="variable">$pos3</span> = <span class="title function_ invoke__">strrpos</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$code</span>, <span class="number">0</span>, <span class="variable">$pos2</span>), <span class="string">&#x27;$&#x27;</span>);</span><br><span class="line">    <span class="variable">$var_name</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$code</span>, <span class="variable">$pos3</span>, <span class="variable">$pos2</span> - <span class="variable">$pos3</span> - <span class="number">1</span>);</span><br><span class="line">    <span class="variable">$pos4</span> = <span class="title function_ invoke__">strpos</span>(<span class="variable">$code</span>, <span class="variable">$var_name</span>, <span class="variable">$pos1</span>);</span><br><span class="line">    <span class="variable">$pos5</span> = <span class="title function_ invoke__">strpos</span>(<span class="variable">$code</span>, <span class="string">&quot;(&#x27;&quot;</span>, <span class="variable">$pos4</span>);</span><br><span class="line">    <span class="variable">$pos6</span> = <span class="title function_ invoke__">strpos</span>(<span class="variable">$code</span>, <span class="string">&quot;&#x27;)&quot;</span>, <span class="variable">$pos4</span>);</span><br><span class="line">    <span class="variable">$key</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$code</span>, <span class="variable">$pos5</span> + <span class="number">2</span>, <span class="variable">$pos6</span> - <span class="variable">$pos5</span> - <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$key</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$input_file</span> = <span class="variable">$argv</span>[<span class="number">1</span>];</span><br><span class="line"><span class="variable">$output_file</span> = <span class="variable">$argv</span>[<span class="number">1</span>] . <span class="string">&#x27;.decrypted.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$code</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$input_file</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">find_data</span>(<span class="variable">$code</span>);</span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$code</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;未找到加密数据&#x27;</span>, PHP_EOL;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$key</span> = <span class="title function_ invoke__">find_key</span>(<span class="variable">$code</span>);</span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$key</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;未找到秘钥&#x27;</span>, PHP_EOL;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$decrypted</span> = <span class="title function_ invoke__">decrypt</span>(<span class="variable">$data</span>, <span class="variable">$key</span>);</span><br><span class="line"><span class="variable">$uncompressed</span> = <span class="title function_ invoke__">gzuncompress</span>(<span class="variable">$decrypted</span>);</span><br><span class="line"><span class="comment">// 由于可以不勾选代码压缩的选项，所以这里判断一下是否解压成功，解压失败就是没压缩</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$uncompressed</span>) &#123;</span><br><span class="line">    <span class="variable">$decrypted</span> = <span class="title function_ invoke__">str_rot13</span>(<span class="variable">$uncompressed</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$decrypted</span> = <span class="title function_ invoke__">str_rot13</span>(<span class="variable">$decrypted</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$output_file</span>, <span class="variable">$decrypted</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;解密后文件已写入到 &#x27;</span>, <span class="variable">$output_file</span>, PHP_EOL;</span><br></pre></td></tr></table></figure></div>

<h2 id="解题"><a href="#解题" class="headerlink" title="解题"></a>解题</h2><p>没什么好说的，<code>index.php</code> 提示存在 <code>UploadFile.class.php</code>，下载下来之后，发现关键函数，然后数组绕过就vans了</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">php</div></div><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">...</span><br><span class="line"> <span class="comment">// 用.分割文件名，只保留首尾两个字符串，防御Apache解析漏洞</span></span><br><span class="line">    <span class="variable">$origin_name</span> = <span class="title function_ invoke__">current</span>(<span class="variable">$filename</span>);</span><br><span class="line">    <span class="variable">$ext</span> = <span class="title function_ invoke__">end</span>(<span class="variable">$filename</span>);</span><br><span class="line">    <span class="variable">$new_name</span> = (<span class="variable language_">$this</span>-&gt;new_name ? <span class="variable language_">$this</span>-&gt;new_name : <span class="variable">$origin_name</span>) . <span class="string">&#x27;.&#x27;</span> . <span class="variable">$ext</span>;</span><br><span class="line">    <span class="variable">$target_fullpath</span> = <span class="variable language_">$this</span>-&gt;dist_path . DIRECTORY_SEPARATOR . <span class="variable">$new_name</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://www.virzz.com/2017/09/20/pwnhub_writeups_sha_fu_fu_workdays.html">Virink师傅的题解</a><br><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/unobfuscated-phpjiami.html">p神的出题原理</a><br><a target="_blank" rel="noopener" href="http://lovei.org/archives/pwnhub6669.html">腹黑师傅的wp</a><br><a target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-693641-1-1.html">Ganlv 师傅的解码思路</a><br><a target="_blank" rel="noopener" href="https://www.colabug.com/2018/0209/2334241/">某PHP加密文件解密过程初探</a></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Manayakko</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://manayakko.github.io/yakko117/2020/03/26/php%E6%B7%B7%E6%B7%86%E5%8A%A0%E5%AF%86/">https://manayakko.github.io/yakko117/2020/03/26/php%E6%B7%B7%E6%B7%86%E5%8A%A0%E5%AF%86/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://manayakko.github.io/yakko117">Manayakko - 微笑才是王道</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/yakko117/tags/php/">php    </a><a class="post-meta__tags" href="/yakko117/tags/code-audit/">code audit    </a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/Manayakko/PicBed/img2/php_decode6.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/yakko117/img/Wechat.jpg" alt="微信"><div class="post-qr-code__desc">微信</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/yakko117/2020/03/29/Ddos%E5%AD%A6%E4%B9%A0/"><img class="prev_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/Manayakko/PicBed/img2/ddos_0.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>DDoS原理与防御</span></div></a></div><div class="next-post pull_right"><a href="/yakko117/2020/03/18/XXElearn/"><img class="next_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/Manayakko/PicBed/img2/ff15.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>XXE漏洞学习</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/yakko117/2019/12/02/Phar/" title="PHP中关于Phar的学习"><img class="relatedPosts_cover lazyload"data-src="https://manayakko.github.io/yakko117/img/index2.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-history fa-fw" aria-hidden="true"></i> 2019-12-02</div><div class="relatedPosts_title">PHP中关于Phar的学习</div></div></a></div><div class="relatedPosts_item"><a href="/yakko117/2019/01/22/PHP弱类型总结/" title="PHP code audit"><img class="relatedPosts_cover lazyload"data-src="https://manayakko.github.io/yakko117/img/index2.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-history fa-fw" aria-hidden="true"></i> 2019-01-22</div><div class="relatedPosts_title">PHP code audit</div></div></a></div><div class="relatedPosts_item"><a href="/yakko117/2020/02/12/php小特性/" title="从一道题学习php的小特性"><img class="relatedPosts_cover lazyload"data-src="https://manayakko.github.io/yakko117/img/index2.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-history fa-fw" aria-hidden="true"></i> 2020-02-12</div><div class="relatedPosts_title">从一道题学习php的小特性</div></div></a></div></div><div class="clear_both"></div></div></div></main><footer id="footer" style="background-image: url(https://cdn.jsdelivr.net/gh/Manayakko/PicBed/img2/php_decode6.png)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2023 By Manayakko</div><div class="framework-info"><span>驱动 </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/yakko117/js/utils.js"></script><script src="/yakko117/js/main.js"></script><script src="/yakko117/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css"><script>$(function () {
  $('span.katex-display').wrap('<div class="katex-wrap"></div>')
})</script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="/yakko117/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/yakko117/live2dw/assets/assets/shizuku.model.json"},"display":{"position":"right","hOffset":60,"vOffset":-20,"width":90,"height":180},"mobile":{"show":false},"log":false});</script></body></html>