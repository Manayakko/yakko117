<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>BuuctfDay9 | Manayakko - 微笑才是王道</title><meta name="description" content="BuuctfDay9"><meta name="keywords" content="writeup,ctf"><meta name="author" content="Manayakko"><meta name="copyright" content="Manayakko"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/yakko117/img/favicon.png"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><meta name="twitter:card" content="summary"><meta name="twitter:title" content="BuuctfDay9"><meta name="twitter:description" content="BuuctfDay9"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/Manayakko/PicBed/img/0077TIyQgy1gbqexv5i14j308k08ot9j.jpg"><meta property="og:type" content="article"><meta property="og:title" content="BuuctfDay9"><meta property="og:url" content="https://manayakko.github.io/yakko117/2022/01/03/buuctfDay09/"><meta property="og:site_name" content="Manayakko - 微笑才是王道"><meta property="og:description" content="BuuctfDay9"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Manayakko/PicBed/img/0077TIyQgy1gbqexv5i14j308k08ot9j.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/yakko117/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://manayakko.github.io/yakko117/2022/01/03/buuctfDay09/"><link rel="prev" title="BuuctfDay10" href="https://manayakko.github.io/yakko117/2022/01/04/BUUCTFDay10/"><link rel="next" title="Ha1cyonCTF2020-公开赛" href="https://manayakko.github.io/yakko117/2020/04/18/NPUCTF2020/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/yakko117/',
  algolia: undefined,
  localSearch: {"path":"./search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: false,
  copyright: {"languages":{"author":"作者: Manayakko","link":"链接: https://manayakko.github.io/yakko117/2022/01/03/buuctfDay09/","source":"来源: Manayakko - 微笑才是王道","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/yakko117/atom.xml" title="Manayakko - 微笑才是王道" type="application/atom+xml">
</head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/yakko117/">Manayakko - 微笑才是王道</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/yakko117/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/yakko117/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/yakko117/link/"><i class="fa-fw fa fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/yakko117/about/"><i class="fa-fw fa fa-simplybuilt"></i><span> 关于本人</span></a></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/yakko117/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/yakko117/archives/"><div class="headline">文章</div><div class="length_num">71</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/yakko117/tags/"><div class="headline">标签</div><div class="length_num">12</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/yakko117/categories/"><div class="headline">分类</div><div class="length_num">5</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/yakko117/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/yakko117/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/yakko117/link/"><i class="fa-fw fa fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/yakko117/about/"><i class="fa-fw fa fa-simplybuilt"></i><span> 关于本人</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#NPUCTF2020-web%F0%9F%90%95"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">[NPUCTF2020] web🐕</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E8%80%83%E7%82%B9%EF%BC%9A"><span class="toc_mobile_items-number">1.1.</span> <span class="toc_mobile_items-text">考点：</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Zer0pts2020-Can-you-guess-it"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">[Zer0pts2020]Can you guess it?</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E4%B8%BB%E8%A6%81%E8%AF%B4%E4%B8%80%E4%B8%8B%E5%87%A0%E4%B8%AA%E5%85%B3%E9%94%AE%E7%82%B9"><span class="toc_mobile_items-number">2.1.</span> <span class="toc_mobile_items-text">主要说一下几个关键点</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E4%BB%A5%E4%B8%8D%E5%90%8C%E6%95%A3%E5%88%97%E7%B1%BB%E5%9E%8B%E4%BD%BF%E7%94%A8-crypt"><span class="toc_mobile_items-number">2.2.</span> <span class="toc_mobile_items-text">以不同散列类型使用 crypt()</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#CRYPT-STD-DES-%E5%9F%BA%E4%BA%8E%E6%A0%87%E5%87%86-DES-%E7%AE%97%E6%B3%95%E7%9A%84%E6%95%A3%E5%88%97%E4%BD%BF%E7%94%A8"><span class="toc_mobile_items-number">2.2.1.</span> <span class="toc_mobile_items-text">CRYPT_STD_DES - 基于标准 DES 算法的散列使用</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#CRYPT-EXT-DES-%E6%89%A9%E5%B1%95%E7%9A%84%E5%9F%BA%E4%BA%8E-DES-%E7%AE%97%E6%B3%95%E7%9A%84%E6%95%A3%E5%88%97%E3%80%82"><span class="toc_mobile_items-number">2.2.2.</span> <span class="toc_mobile_items-text">CRYPT_EXT_DES - 扩展的基于 DES 算法的散列。</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#CRYPT-MD5-MD5-%E6%95%A3%E5%88%97"><span class="toc_mobile_items-number">2.2.3.</span> <span class="toc_mobile_items-text">CRYPT_MD5 - MD5 散列</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#CRYPT-BLOWFISH-Blowfish-%E7%AE%97%E6%B3%95"><span class="toc_mobile_items-number">2.2.4.</span> <span class="toc_mobile_items-text">CRYPT_BLOWFISH - Blowfish 算法</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#CRYPT-SHA256-x2F-SHA512-%E6%95%A3%E5%88%97%E7%AE%97%E6%B3%95"><span class="toc_mobile_items-number">2.2.5.</span> <span class="toc_mobile_items-text">CRYPT_SHA256&#x2F;SHA512 散列算法</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#%E5%9B%9E%E5%BD%92%E5%88%B0%E8%A7%A3%E9%A2%98%E6%9C%AC%E8%BA%AB"><span class="toc_mobile_items-number">2.3.</span> <span class="toc_mobile_items-text">回归到解题本身</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#%E6%80%9D%E8%B7%AF1"><span class="toc_mobile_items-number">2.3.1.</span> <span class="toc_mobile_items-text">思路1</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#%E6%80%9D%E8%B7%AF2"><span class="toc_mobile_items-number">2.3.2.</span> <span class="toc_mobile_items-text">思路2</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#%E5%8F%A8%E9%80%BC%E5%87%A0%E5%8F%A5"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">叨逼几句</span></a></li></ol></div></div></div><div id="body-wrap"><div id="web_bg" data-type="photo"></div><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#NPUCTF2020-web%F0%9F%90%95"><span class="toc-number">1.</span> <span class="toc-text">[NPUCTF2020] web🐕</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%80%83%E7%82%B9%EF%BC%9A"><span class="toc-number">1.1.</span> <span class="toc-text">考点：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Zer0pts2020-Can-you-guess-it"><span class="toc-number">2.</span> <span class="toc-text">[Zer0pts2020]Can you guess it?</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E8%A6%81%E8%AF%B4%E4%B8%80%E4%B8%8B%E5%87%A0%E4%B8%AA%E5%85%B3%E9%94%AE%E7%82%B9"><span class="toc-number">2.1.</span> <span class="toc-text">主要说一下几个关键点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A5%E4%B8%8D%E5%90%8C%E6%95%A3%E5%88%97%E7%B1%BB%E5%9E%8B%E4%BD%BF%E7%94%A8-crypt"><span class="toc-number">2.2.</span> <span class="toc-text">以不同散列类型使用 crypt()</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CRYPT-STD-DES-%E5%9F%BA%E4%BA%8E%E6%A0%87%E5%87%86-DES-%E7%AE%97%E6%B3%95%E7%9A%84%E6%95%A3%E5%88%97%E4%BD%BF%E7%94%A8"><span class="toc-number">2.2.1.</span> <span class="toc-text">CRYPT_STD_DES - 基于标准 DES 算法的散列使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CRYPT-EXT-DES-%E6%89%A9%E5%B1%95%E7%9A%84%E5%9F%BA%E4%BA%8E-DES-%E7%AE%97%E6%B3%95%E7%9A%84%E6%95%A3%E5%88%97%E3%80%82"><span class="toc-number">2.2.2.</span> <span class="toc-text">CRYPT_EXT_DES - 扩展的基于 DES 算法的散列。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CRYPT-MD5-MD5-%E6%95%A3%E5%88%97"><span class="toc-number">2.2.3.</span> <span class="toc-text">CRYPT_MD5 - MD5 散列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CRYPT-BLOWFISH-Blowfish-%E7%AE%97%E6%B3%95"><span class="toc-number">2.2.4.</span> <span class="toc-text">CRYPT_BLOWFISH - Blowfish 算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CRYPT-SHA256-x2F-SHA512-%E6%95%A3%E5%88%97%E7%AE%97%E6%B3%95"><span class="toc-number">2.2.5.</span> <span class="toc-text">CRYPT_SHA256&#x2F;SHA512 散列算法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9E%E5%BD%92%E5%88%B0%E8%A7%A3%E9%A2%98%E6%9C%AC%E8%BA%AB"><span class="toc-number">2.3.</span> <span class="toc-text">回归到解题本身</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF1"><span class="toc-number">2.3.1.</span> <span class="toc-text">思路1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF2"><span class="toc-number">2.3.2.</span> <span class="toc-text">思路2</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%A8%E9%80%BC%E5%87%A0%E5%8F%A5"><span class="toc-number">3.</span> <span class="toc-text">叨逼几句</span></a></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/Manayakko/PicBed/img/0077TIyQgy1gbqexv5i14j308k08ot9j.jpg)"><div id="post-info"><div id="post-title"><div class="posttitle">BuuctfDay9</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 发表于 2022-01-03<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> 更新于 2023-04-19</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/yakko117/categories/%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0/">做题笔记</a></span><div class="post-meta-wordcount"><div class="post-meta-pv-cv"></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><p>很久没更新了，因为各种原因摸了一年多的鱼</p>
<h1 id="NPUCTF2020-web🐕"><a href="#NPUCTF2020-web🐕" class="headerlink" title="[NPUCTF2020] web🐕"></a>[NPUCTF2020] web🐕</h1><p>首先先看一下题目</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">php</div></div><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">我摊牌了，就是懒得写前端</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;config.php&#x27;</span>);   <span class="comment"># $key,$flag</span></span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&quot;METHOD&quot;</span>, <span class="string">&quot;aes-128-cbc&quot;</span>);  <span class="comment">//定义加密方式</span></span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&quot;SECRET_KEY&quot;</span>, <span class="variable">$key</span>);    <span class="comment">//定义密钥</span></span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&quot;IV&quot;</span>,<span class="string">&quot;6666666666666666&quot;</span>);    <span class="comment">//定义初始向量 16个6</span></span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&quot;BR&quot;</span>,<span class="string">&#x27;&lt;br&gt;&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>]))<span class="title function_ invoke__">header</span>(<span class="string">&#x27;location:./index.php?source=1&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">#var_dump($GLOBALS);   //听说你想看这个？</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">aes_encrypt</span>(<span class="params"><span class="variable">$iv</span>,<span class="variable">$data</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;--------encrypt---------&quot;</span>.BR;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;IV:&#x27;</span>.<span class="variable">$iv</span>.BR;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">openssl_encrypt</span>(<span class="variable">$data</span>, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, <span class="variable">$iv</span>)).BR;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">aes_decrypt</span>(<span class="params"><span class="variable">$iv</span>,<span class="variable">$data</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">openssl_decrypt</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$data</span>),METHOD,SECRET_KEY,OPENSSL_RAW_DATA,<span class="variable">$iv</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&#x27;False&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;method&#x27;</span>]==<span class="string">&#x27;encrypt&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$iv</span> = IV;</span><br><span class="line">    <span class="variable">$data</span> = <span class="variable">$flag</span>;    </span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">aes_encrypt</span>(<span class="variable">$iv</span>,<span class="variable">$data</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;method&#x27;</span>]==<span class="string">&quot;decrypt&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$iv</span> = @<span class="variable">$_POST</span>[<span class="string">&#x27;iv&#x27;</span>];</span><br><span class="line">    <span class="variable">$data</span> = @<span class="variable">$_POST</span>[<span class="string">&#x27;data&#x27;</span>];</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">aes_decrypt</span>(<span class="variable">$iv</span>,<span class="variable">$data</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;我摊牌了，就是懒得写前端&quot;</span>.BR;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>]==<span class="number">1</span>)<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div>

<h2 id="考点："><a href="#考点：" class="headerlink" title="考点："></a>考点：</h2><ul>
<li>PHP AES 加密</li>
<li>CBC字节翻转攻击 <a target="_blank" rel="noopener" href="https://www.smi1e.top/cbc%E5%AD%97%E8%8A%82%E7%BF%BB%E8%BD%AC%E6%94%BB%E5%87%BB%E5%92%8Cpadding-oracle/">微笑师傅的分析讲解</a> 以及 <a target="_blank" rel="noopener" href="https://wooyun.js.org/drops/CBC%E5%AD%97%E8%8A%82%E7%BF%BB%E8%BD%AC%E6%94%BB%E5%87%BB-101Approach.html">wooyun的技术分析帖</a></li>
<li>还有这篇 <a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/15504.html">Padding Oracle攻击的分析和思考（详细）</a></li>
</ul>
<p>程序是 <code>128位的cbc</code>，<code>blocksize是16字节</code>，加密 <code>IV</code> 已知，<code>secret</code> 未知<br>但是可以知道解密是否成功，而且可以控制密文和解密的 <code>IV</code><br>可以使用 <code>padding oracle</code> 爆出明文</p>
<p>主要原理是根据 <code>cbc</code> 在 <code>IV padding</code> 正确的情况下的返回值和 <code>padding</code> 错误下的返回值是不一样的，可以利用这个特性逐位还原密文。</p>
<p>找到个<a target="_blank" rel="noopener" href="https://github.com/mpgn/Padding-oracle-attack">脚本</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/sqxssss/NPUCTF_WriteUps/blob/master/npuctf_wp_by_star.md">https://github.com/sqxssss/NPUCTF_WriteUps/blob/master/npuctf_wp_by_star.md</a></p>
<p><a target="_blank" rel="noopener" href="http://wh1sper.cn/padding-oracle-attackcbc%e5%ad%97%e8%8a%82%e7%bf%bb%e8%bd%ac%e6%94%bb%e5%87%bb/">http://wh1sper.cn/padding-oracle-attackcbc%e5%ad%97%e8%8a%82%e7%bf%bb%e8%bd%ac%e6%94%bb%e5%87%bb/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/7f171477a603">https://www.jianshu.com/p/7f171477a603</a></p>
<hr>
<h1 id="Zer0pts2020-Can-you-guess-it"><a href="#Zer0pts2020-Can-you-guess-it" class="headerlink" title="[Zer0pts2020]Can you guess it?"></a>[Zer0pts2020]Can you guess it?</h1><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">php</div></div><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;config.php&#x27;</span>; <span class="comment">// FLAG is defined in config.php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/config\.php\/*$/i&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>])) &#123;</span><br><span class="line">  <span class="keyword">exit</span>(<span class="string">&quot;I don&#x27;t know what you are thinking, but I won&#x27;t let you read it :)&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>])) &#123;</span><br><span class="line">  <span class="title function_ invoke__">highlight_file</span>(<span class="title function_ invoke__">basename</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>]));</span><br><span class="line">  <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$secret</span> = <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">random_bytes</span>(<span class="number">64</span>));</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;guess&#x27;</span>])) &#123;</span><br><span class="line">  <span class="variable">$guess</span> = (<span class="keyword">string</span>) <span class="variable">$_POST</span>[<span class="string">&#x27;guess&#x27;</span>];</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_ invoke__">hash_equals</span>(<span class="variable">$secret</span>, <span class="variable">$guess</span>)) &#123;</span><br><span class="line">    <span class="variable">$message</span> = <span class="string">&#x27;Congratulations! The flag is: &#x27;</span> . FLAG;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$message</span> = <span class="string">&#x27;Wrong.&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="主要说一下几个关键点"><a href="#主要说一下几个关键点" class="headerlink" title="主要说一下几个关键点"></a>主要说一下几个关键点</h2><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.hash-equals.php">hash_equals 函数</a><br><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.crypt.php">crypt 加密函数</a></p>
<p>在密码学中，时序攻击是一种侧信道攻击，攻击者试图通过分析加密算法的时间执行来推导出密码。每一个逻辑运算在计算机需要时间来执行，根据输入不同，精确测量执行时间，根据执行时间反推出密码。</p>
<p>如果是用普通的 <code>==</code> 来进行比较，那么两个字符串是从第一位开始逐一进行比较的，发现不同就立即返回 <code>false</code>，那么通过计算返回的速度就知道了大概是哪一位开始不同的，<code>php</code> 中为了应对这种情况，就使用 <code>hash_equals函数</code>。</p>
<p>示例如下</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">php</div></div><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$test</span>  = <span class="title function_ invoke__">crypt</span>(<span class="string">&#x27;114514&#x27;</span>, <span class="string">&#x27;$2a$07$stringforsalt$&#x27;</span>);</span><br><span class="line"><span class="variable">$AAA</span>   = <span class="title function_ invoke__">crypt</span>(<span class="string">&#x27;114514&#x27;</span>, <span class="string">&#x27;$2a$07$stringforsalt$&#x27;</span>);</span><br><span class="line"><span class="variable">$BBB</span> = <span class="title function_ invoke__">crypt</span>(<span class="string">&#x27;manako&#x27;</span>, <span class="string">&#x27;$2a$07$stringforsalt$&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">hash_equals</span>(<span class="variable">$test</span>, <span class="variable">$AAA</span>));</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">hash_equals</span>(<span class="variable">$test</span>, <span class="variable">$BBB</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div>
<p>回显</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">php</div></div><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span>(<span class="literal">true</span>)</span><br><span class="line"><span class="keyword">bool</span>(<span class="literal">true</span>)</span><br></pre></td></tr></table></figure></div>

<p>而将盐值修改为要求的散列类 <code>$2a$07$usesomesillystringforsalt$</code><br>或者去掉bool变量定义，直接将盐值变成 <code>stringforsalt</code> 返回会判定为 <code>false</code></p>
<p>同时看到一句这样的话:</p>
<blockquote>
<p>When the failure string “*0” is given as the salt, “*1” will now be returned for consistency with other crypt implementations. Prior to this version, PHP 5.6 would incorrectly return a DES hash.</p>
</blockquote>
<p>首先来看一下这个加密算法<br><code>crypt</code> 有两个参数：<br>第一个参数：加密字符串<br>第二个参数：盐值字符串 <code>/$str = &#39;123456789&#39;</code>;<br>使用自动盐值 <code>echo&#39;自动 盐值: &#39; . crypt($str) . &quot;\n&quot;; </code><br>如 <code>$1$yvnZHBo0$sBZBd0vzZYnxbtQftQulZ</code></p>
<hr>
<h2 id="以不同散列类型使用-crypt"><a href="#以不同散列类型使用-crypt" class="headerlink" title="以不同散列类型使用 crypt()"></a>以不同散列类型使用 crypt()</h2><h3 id="CRYPT-STD-DES-基于标准-DES-算法的散列使用"><a href="#CRYPT-STD-DES-基于标准-DES-算法的散列使用" class="headerlink" title="CRYPT_STD_DES - 基于标准 DES 算法的散列使用"></a>CRYPT_STD_DES - 基于标准 DES 算法的散列使用</h3><p><code>./0-9A-Za-z</code> 字符中的两个字符作为盐值。<br>在盐值中使用非法的字符将导致 <code>crypt()</code> 失败。</p>
<h3 id="CRYPT-EXT-DES-扩展的基于-DES-算法的散列。"><a href="#CRYPT-EXT-DES-扩展的基于-DES-算法的散列。" class="headerlink" title="CRYPT_EXT_DES - 扩展的基于 DES 算法的散列。"></a>CRYPT_EXT_DES - 扩展的基于 DES 算法的散列。</h3><p>其盐值为 <code>9</code> 个字符的字符串，由 <code>1</code> 个下划线后面跟着 <code>4</code> 字节循环次数和 <code>4</code> 字节盐值组成。<br>它们被编码成可打印字符，每个字符 <code>6</code> 位，有效位最少的优先。<br><code>0</code> 到 <code>63</code> 被编码为 <code>./0-9A-Za-z</code>。</p>
<h3 id="CRYPT-MD5-MD5-散列"><a href="#CRYPT-MD5-MD5-散列" class="headerlink" title="CRYPT_MD5 - MD5 散列"></a>CRYPT_MD5 - MD5 散列</h3><p>使用一个以 <code>$1$</code> 开始的 <code>12</code> 字符的字符串盐值。</p>
<h3 id="CRYPT-BLOWFISH-Blowfish-算法"><a href="#CRYPT-BLOWFISH-Blowfish-算法" class="headerlink" title="CRYPT_BLOWFISH - Blowfish 算法"></a>CRYPT_BLOWFISH - Blowfish 算法</h3><p>使用如下盐值：<code>$2a$</code>，一个两位 <code>cost</code> 参数，<code>$</code> 以及 <code>64</code> 位由 <code>./0-9A-Za-z</code> 中的字符组合而成的字符串。<br>在盐值中使用此范围之外的字符将导致 <code>crypt()</code> 返回一个空字符串。<br>两位 <code>cost</code> 参数是循环次数以 <code>2</code> 为底的对数，它的范围是 <code>04-31</code>，超出这个范围将导致 <code>crypt()</code> 失败。</p>
<p><font color="red">！！！需要注意到一点</font>，盐值要求为 <code>64位</code>，长度不满足就会加密失败，这就是为什么上面的示例使用<code>$2a$07$stringforsalt$</code> 会出现 <code>hash</code> 验证为 <code>true</code>;</p>
<h3 id="CRYPT-SHA256-x2F-SHA512-散列算法"><a href="#CRYPT-SHA256-x2F-SHA512-散列算法" class="headerlink" title="CRYPT_SHA256&#x2F;SHA512 散列算法"></a>CRYPT_SHA256&#x2F;SHA512 散列算法</h3><p><code>SHA-256</code> 算法使用一个以 <code>$5$</code> 开头的 <code>16</code> 字符字符串盐值进行散列<br>如果盐值字符串以 <code>rounds=$</code> 开头，<code>N</code> 的数字值将被用来指定散列循环的执行次数，这点很像 Blowfish 算法的 <code>cost</code> 参数。默认的循环次数是 <code>5000</code>，最小是 <code>1000</code>，最大是 <code>999,999,999</code>。超出这个范围的 <code>N</code> 将会被转换为最接近的值。</p>
<p><code>SHA-256</code> 和 <code>SHA-512</code> 同理</p>
<p>加密示例</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">php</div></div><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (CRYPT_STD_DES == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Standard DES: &#x27;</span> . <span class="title function_ invoke__">crypt</span>(<span class="string">&#x27;rasmuslerdorf&#x27;</span>, <span class="string">&#x27;rl&#x27;</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (CRYPT_EXT_DES == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Extended DES: &#x27;</span> . <span class="title function_ invoke__">crypt</span>(<span class="string">&#x27;rasmuslerdorf&#x27;</span>, <span class="string">&#x27;_J9..rasm&#x27;</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (CRYPT_MD5 == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;MD5:          &#x27;</span> . <span class="title function_ invoke__">crypt</span>(<span class="string">&#x27;rasmuslerdorf&#x27;</span>, <span class="string">&#x27;$1$rasmusle$&#x27;</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (CRYPT_BLOWFISH == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Blowfish:     &#x27;</span> . <span class="title function_ invoke__">crypt</span>(<span class="string">&#x27;rasmuslerdorf&#x27;</span>, <span class="string">&#x27;$2a$07$usesomesillystringforsalt$&#x27;</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (CRYPT_SHA256 == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;SHA-256:      &#x27;</span> . <span class="title function_ invoke__">crypt</span>(<span class="string">&#x27;rasmuslerdorf&#x27;</span>, <span class="string">&#x27;$5$rounds=5000$usesomesillystringforsalt$&#x27;</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (CRYPT_SHA512 == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;SHA-512:      &#x27;</span> . <span class="title function_ invoke__">crypt</span>(<span class="string">&#x27;rasmuslerdorf&#x27;</span>, <span class="string">&#x27;$6$rounds=5000$usesomesillystringforsalt$&#x27;</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div>

<hr>
<h2 id="回归到解题本身"><a href="#回归到解题本身" class="headerlink" title="回归到解题本身"></a>回归到解题本身</h2><h3 id="思路1"><a href="#思路1" class="headerlink" title="思路1"></a>思路1</h3><p>比较两个提交的参数是否相等，则给出flag，<code>random_bytes</code>函数生成适合于加密使用的任意长度的加密随机字节字符串，随后通过<code>bin2hex</code>转换为十六进制值</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">php</div></div><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> (<span class="title function_ invoke__">random_bytes</span>(<span class="number">64</span>)) .<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line"><span class="comment">//需要将PHP version 更改为&gt;=7</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">random_bytes</span>(<span class="number">64</span>)) .<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> (<span class="title function_ invoke__">random_bytes</span>(<span class="number">64</span>)) .<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">random_bytes</span>(<span class="number">64</span>)) .<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div>

<h3 id="思路2"><a href="#思路2" class="headerlink" title="思路2"></a>思路2</h3><p>绕过正则表达式访问开头源码提示flag的config.php</p>
<p>需要了解的几个东西 <a target="_blank" rel="noopener" href="https://www.php.net/basename">basename函数</a> 以及 <a target="_blank" rel="noopener" href="https://bugs.php.net/bug.php?id=62119">函数漏洞</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42314192/article/details/116257437">参考思路，PHP里的basename函数不支持中文名的解决</a></p>
<p>首先先看全局变量 <code>$_SERVER[‘PHP_SELF’]</code> </p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">php</div></div><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_SERVER</span>[‘PHP_SELF’] 获取当前页面地址</span><br><span class="line">是当前 php 文件相对于网站根目录的位置地址</span><br><span class="line"></span><br><span class="line">http:<span class="comment">//www.test.com/php/ | /php/index.php</span></span><br><span class="line">http:<span class="comment">//www.test.com/php/index.php | /php/index.php</span></span><br><span class="line">http:<span class="comment">//www.test.com/php/index.php?test=yakko | /php/index.php</span></span><br><span class="line">http:<span class="comment">//www.test.com/php/index.php/test/yakko | /php/index.php/test/yakko</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$_SERVER</span>[‘REQUEST_URI’]完整url地址，包括请求的url参数</span><br><span class="line"></span><br><span class="line"><span class="variable">$_SERVER</span>[‘HTTP_HOST’]只有一段的域名,不包括前面的协议和后面的相对位置</span><br></pre></td></tr></table></figure></div>

<p>访问 <code>/index.php/config.php</code>，经过 <code>basename()</code> 传入 <code>highlight_file()</code> 的文件名就会变成 <code>config.php</code></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">php</div></div><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$url1</span> = <span class="string">&quot;testpath/index.php&quot;</span>;</span><br><span class="line">     <span class="comment">// 返回index.php</span></span><br><span class="line">    </span><br><span class="line">    <span class="variable">$url2</span> = <span class="string">&quot;testpath/index.php&quot;</span>.<span class="title function_ invoke__">urldecode</span>(<span class="string">&#x27;%D1%A7%CF&#x27;</span>); </span><br><span class="line">    <span class="comment">// 返回index.php和乱码</span></span><br><span class="line">    </span><br><span class="line">    <span class="variable">$url3</span> = <span class="title function_ invoke__">urldecode</span>(<span class="string">&#x27;%D1%A7%CF%B0index.php+ &#x27;</span>);</span><br><span class="line">     <span class="comment">// 返回flag，前面的非acsii被删除</span></span><br><span class="line">    </span><br><span class="line">    <span class="variable">$url4</span> = <span class="title function_ invoke__">urldecode</span>(<span class="string">&#x27;index.php%D1%A7%CF%B0 &#x27;</span>); </span><br><span class="line">    <span class="comment">// 返回flag和后面的非ascii</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">basename</span>(<span class="variable">$url1</span>) .<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">basename</span>(<span class="variable">$url2</span>) .<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">basename</span>(<span class="variable">$url3</span>) .<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">basename</span>(<span class="variable">$url4</span>) .<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>Payload1</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">http</div></div><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://xxx.com/index.php/config.php/任意中文?source</span><br></pre></td></tr></table></figure></div>

<p>以及大佬的fuzz思路</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">php</div></div><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/config\.php\/*$/i&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="number">255</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">    <span class="variable">$str</span>=<span class="string">&quot;/index.php/config.php/&quot;</span>.<span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">check</span>(<span class="variable">$str</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$i</span>.<span class="string">&quot;：&quot;</span>.<span class="title function_ invoke__">basename</span>(<span class="variable">$str</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>Payload2</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">http</div></div><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://xxx.com/index.php/config.php/%80?source</span><br></pre></td></tr></table></figure></div>

<p>参考很多大佬的思路<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_58784379/article/details/121742710">sGanYu(Zer0pts2020)basename函数漏洞</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/rfrder/article/details/110929280">bfengj(Zer0pts2020)Can you guess it?的WP</a></p>
<hr>
<h1 id="叨逼几句"><a href="#叨逼几句" class="headerlink" title="叨逼几句"></a>叨逼几句</h1><p>很久没做题了，摸了太久了，的确自己生疏了很多，2021年确实很多事情不怎么顺，希望新的一年能好一些吧</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Manayakko</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://manayakko.github.io/yakko117/2022/01/03/buuctfDay09/">https://manayakko.github.io/yakko117/2022/01/03/buuctfDay09/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://manayakko.github.io/yakko117">Manayakko - 微笑才是王道</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/yakko117/tags/writeup/">writeup    </a><a class="post-meta__tags" href="/yakko117/tags/ctf/">ctf    </a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/Manayakko/PicBed/img/0077TIyQgy1gbqexv5i14j308k08ot9j.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/yakko117/2022/01/04/BUUCTFDay10/"><img class="prev_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/Manayakko/PicBed/img/9a88975fec4255819a88f8d9c73c8948.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>BuuctfDay10</span></div></a></div><div class="next-post pull_right"><a href="/yakko117/2020/04/18/NPUCTF2020/"><img class="next_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/Manayakko/PicBed/img/0077TIyQgy1gbqexv5i14j308k08ot9j.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>Ha1cyonCTF2020-公开赛</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/yakko117/2020/01/31/2020新春红包/" title="赵师傅的新春红包题"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/Manayakko/PicBed/img2/redpack.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-history fa-fw" aria-hidden="true"></i> 2023-04-19</div><div class="relatedPosts_title">赵师傅的新春红包题</div></div></a></div><div class="relatedPosts_item"><a href="/yakko117/2019/04/05/Bugkuctf/" title="Bugku吹头发 writeup（慢慢更）"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/Manayakko/PicBed/img/6b8c14f8gy1fvcdnepp5yj218g0tn48s.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-history fa-fw" aria-hidden="true"></i> 2023-04-19</div><div class="relatedPosts_title">Bugku吹头发 writeup（慢慢更）</div></div></a></div><div class="relatedPosts_item"><a href="/yakko117/2023/03/16/BUUCTFDay11/" title="BuuctfDay11"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/Manayakko/PicBed/img/9a88975fec4255819a88f8d9c73c8948.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-history fa-fw" aria-hidden="true"></i> 2024-01-20</div><div class="relatedPosts_title">BuuctfDay11</div></div></a></div></div><div class="clear_both"></div></div></div></main><footer id="footer" style="background-image: url(https://cdn.jsdelivr.net/gh/Manayakko/PicBed/img/0077TIyQgy1gbqexv5i14j308k08ot9j.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2024 By Manayakko</div><div class="framework-info"><span>驱动 </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/yakko117/js/utils.js"></script><script src="/yakko117/js/main.js"></script><script src="/yakko117/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css"><script>$(function () {
  $('span.katex-display').wrap('<div class="katex-wrap"></div>')
})</script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="/yakko117/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/yakko117/live2dw/assets/assets/shizuku.model.json"},"display":{"position":"right","hOffset":60,"vOffset":-20,"width":90,"height":180},"mobile":{"show":false},"log":false});</script></body></html>